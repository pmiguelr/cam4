var Comments=function(){function reloadComments(username){var pageData={t:Math.floor(99999999999*Math.random())};$j("#commentsPageWrapper").load("/_profile/asyncComment?username="+username,$j.param(pageData),function(response,success,xhr){})}function destroyMessageInCookie(){Cam4Cookies.deleteCookie("chatWallMessage")}function textToggle(){"none"==document.getElementById("t1").style.display&&""==document.getElementById("message-wall").value?(document.getElementById("t1").style.display="block",document.getElementById("message-wall").style.display="none",document.getElementById("t3").style.display="none"):(document.getElementById("t1").style.display="none",document.getElementById("message-wall").style.display="block",document.getElementById("t3").style.display="inline-block")}function setChatWallDisplayEvents(){var chatInput=$j("#t1"),chatPostButton=$j("#t3"),chatWall=$j("#message-wall");chatInput.on("focus",function(){$j(this).hide(),chatPostButton.show(),chatWall.show().focus()}),chatWall.on("focus",function(){chatPostButton.show()}),$j(window).on("click",function(e){e.target!=chatPostButton&&""==chatWall.val()&&"message-wall"!=e.target.id&&(chatPostButton.hide(),chatInput.show(),chatWall.hide())})}var msg=function(){var msg=Cam4Cookies.getCookie("chatWallMessage");return null==msg&&(msg=""),msg}();if(""!=msg&&textToggle(),document.getElementById("message-wall")&&(document.getElementById("message-wall").value=msg),setChatWallDisplayEvents(),null==document.getElementById("giftShelfWrap")){var colChatWall=document.getElementById("col2ChatWall");null!=colChatWall&&(colChatWall.style.width="100%")}if(null==document.getElementById("col2ChatWall")){var colGift=document.getElementById("giftShelfWrap");null!=colGift&&(colGift.style.width="auto")}return publicAPI={setChatWallDisplayEvents:setChatWallDisplayEvents,addComment:function(username){if(idVerificationEnabled||"pending"!==Cam4User.broadcasterStatusCached)if(Cam4User.isLoggedInAsGuest)Registration.activateGuestRegisterModal();else{var rdmVal=Math.floor(99999999999*Math.random()),message=$j("#message-wall").val();if(""!==message){var settings={data:{t:rdmVal,action:"post",message:message},type:"POST",url:"/"+username+"/wall",success:function(){destroyMessageInCookie(),$j("#commentForm")[0].reset(),reloadComments(username)},complete:function(jqXHR){var data=jQuery.parseJSON(jqXHR.responseText);$j("#commentPrompt").text(""),"OK"==data.code||"tooLong"==data.code?$j("#commentForm").show():"ERROR_PENDING_BROADCASTER"==data.code&&Modals.openUnderAgeModal(),$j(".deletelink").show()}};$j(".deletelink, #commentForm").hide(),$j.ajax(settings)}}else Modals.openUnderAgeModal()},removeComment:function(commentId,firebaseId,start,username){var settings={data:{t:Math.floor(99999999999*Math.random()),action:"delete",commentId:commentId,firebaseId:firebaseId},type:"POST",url:"/"+username+"/wall",success:function(){reloadComments(username)},complete:function(jqXHR){$j("#commentPrompt").html(jqXHR.responseText).text("");var data=jQuery.parseJSON(jqXHR.responseText);null!=data&&"tryLater"==data.code||""==jqXHR.responseText&&$j("#commentForm").show()}};$j(".deletelink, #commentForm").hide(),$j.ajax(settings)},trimComment:function(field){field.value.length<=250||(field.value=field.value.substring(0,250))},saveMessageInCookie:function(message){Cam4Cookies.setCookie("chatWallMessage",message,36e5)},textToggle:textToggle}}();